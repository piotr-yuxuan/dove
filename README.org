#+TITLE:ðŸ•Š [[https://clojars.org/dove][dove]] [[https://img.shields.io/clojars/v/dove.svg]]

https://clojars.org/dove

Recursively infer clojure spec from any (nested) =org.apache.avro.Schema=.

[[resources/avro.jpg]]

Avro was a British aircraft manufacturer. Nowadays it is a data
serialization framework. A dove is smaller than an Avro aircraft, but
it's softer and you can hold it in your hand, which makes it much more
convenient when dealing with data manually.

Its purpose is to recursively infer and register specs
from any (nested) =org.apache.avro.Schema= so it enables generative
testing and pre-serialisation validation.

* Usage

#+BEGIN_SRC clojure
(import '(some.package SomeAvroSchema))
(require '[dove.core :as dove]
         '[clojure.spec.alpha :as s]
         '[clojure.spec.gen.alpha :as g])

(to-spec!
 (SomeAvroSchema/getClassSchema)
 {:dry-run? false})

(s/def :some.package/UID
  (s/with-gen
    uuid?
    #(test.g/fmap bytes-to-uuid (s/gen (->avro-fixed? 16)))))

(->> :some.package/UID
     s/gen
     g/generate)

(s/def :some.package/IPv4
  (s/with-gen
    ip/address?
    #(test.g/fmap ip/address (s/gen (->avro-fixed? 4)))))

(->> :some.package/IPv4
     s/gen
     g/generate)

(s/def :some.package/IPv6
  (s/with-gen
    ip/address?
    #(test.g/fmap ip/address (s/gen (->avro-fixed? 16)))))

(->> :some.package/IPv6
     s/gen
     g/generate
     (f-keys (comp keyword name)))

(->> :some.package/SomeAvroSchema
     s/gen
     g/generate
     ;; Strip keywords from their namespace (optionnal, syntactic
     ;; sugar to ease integration with existing codebase)
     (dove/f-keys (comp keyword name)))
#+END_SRC

* Troubleshoot

This small, pre-alpha quality library is currently under
development. Feel free to give me any feedback and I'll be more than
happy to help you.

* Related projects

I've got a great deal of inspiration from these projects. They might
suit your needs better than dove. Each of them is pretty impressive!

- [[https://github.com/deercreeklabs/lancaster][lancaster]] from [[https://github.com/chadharrington][Chad Harrington]]
- [[https://github.com/metosin/spec-tools][spec-tools]] from [[https://github.com/ikitommi][Tommi Reiman]]
- [[https://github.com/stathissideris/spec-provider][spec-provider]] from [[https://github.com/stathissideris][Stathis Sideris]]
